# I/O

C语言本身并不包含I/O。本章将介绍与I/O、字符串处理、内存管理、数学运算及其他一些标准库函数，其中重点为I/O。

ANSI精确定义了这些标准库，所以在不同环境中不存在兼容性问题。

## 标准输入/输出

一个文本流由一串行序列组成，行间由换行符标记。如果操作系统本身不是如此，stdio.h会强制转换，如将"回车（carriage reterun 和 linefeed）"在输入时转换为换行符，输出时转换回去。

最简单的输入机制为使用getchar函数，每次从_标准输入流（通常为键盘）_ 中读取一个字符：

```c
int getchar(void);
```

每次调用时，getchar返回下一个字符，如果文本流结束，返回EOF。EOF的数值定义在stdio.h内，通常为-1，不过不可依赖。

在一些环境中（如UNIX），可使用`<`重置标准输入流。如果程序prog使用了getchar函数，则命令`prog < infile`将使prog程序冲infile中读取字符。并且，字符串"<infile"并不包含在参数argv内。

此外，还可以使用管道（如UNIX）从另一个程序获得输入流。如命令`otherprog | prog`会将otherprog的标准输出流作为prog的标准输入流。

函数：

```c
int putchar(int);
```

用于输出：putchar(c)将字符c输出到标准输出流中（通常为屏幕），返回值为输出的字符，如果发生错误，则返回EOF。同样，也可使用重定向操作符和管道重定向标准输出流。如果prog函数使用putchar，`prog >outfile`将输出内容输出到outfile内；`prog | anotherprog`将prog的标准输出流作为anotherprog程序的标准输入流。

函数printf输出目标同样为标准输出流，两者可混合使用，输出顺序按调用顺序而定。

使用I/O的每个源文件都需声明使用标准库stdio.h：

```c
#include <stdio.h>
```

- [ex7-1](ex/7-1.c)：实现程序相互转换字符大写和小写，依据argv[0]（程序名称？）确定转换为大写还是小写。

## 格式化输出-printf

使用printf函数可实现格式化输出：

```javascript
int printf(char *format, arg1, arg2, ...);
```

根据format将后面的参数转换到format内，输出到标准输出流，并返回输出字符总数。

format由2类字符组成：常规字符和占位符。占位符以`%`开始，常规字符结束，之间为转换字符。每个占位符依次对应后面的参数。转换字符可能是：

- 减号：左对齐
- 数值：指定最小宽度的。如果真实宽度小于此值默认右对齐（指定左对齐则左对齐）。
- 点：分割宽度精度。
- 数值：指定最大宽度的精度。字符串的最所字符数，或浮点型数值小数点后位数，或整型最多位数。
- h/l等类型转换字符：如果整型输出为short则为h，输出为long则为l...

类型转换字符如下表：

字符  | 含义
:-- | :---------------------------------------------------------------
d,i | int；整型
o   | int；无符号八进制数（无前置0）
x,X | int；无符号十六进制数（无前置0x或0X），使用abcdef或ABCDEF表示10,...15。
u   | int；无符号十进制数
c   | int；单个字符
s   | `char *`；从字符串的第一个字符打印至`\0`，或指定精度数量的字符数
f   | double；`[-]m.dddddd`。其中d的数量由精度控制（默认为6）。
e,E | double；`[-]m.dddddde+/-xx`或`[-]m.ddddddE+/--xx`，其中d的数量由精度控制，默认为6
g,G | double；如果小数点后小于4位，或大于等于控制精度使用科学计数法，即%e或%E；否则使用%f。不打印末尾的0或小数点。
p   | `void *`；指针（具体显示由环境决定）
%   | 打印"%"本身

宽度或精度可使用`*`转换字符代替，对应参数需为整形。如：

```javascript
printf("%*.*s\n", 4, 1, "claudio");
```

表示宽度为4，最多打印1个字符。

前些章节已经涵盖了大多数格式转换，单字符串的转换还不完全，下面以"hello, world"（12个字符）为例展示字符串的格式化输出，前后添加冒号以便观察：

```txt
:%s:          :hello, world:
:%10s:        :hello, world:
:%.10s:       :hello, wor:
:%-10s:       :hello, world:
:%.15s:       :hello, world:
:%-15s:       :hello, world   :
:%15.10s:     :     hello, wor:
:%-15.10s:    :hello, wor     :
```

注意：printf使用第一个参数判断后面参数的个数和类型。观察你下面两个语句：

```c
printf(s); /*如果s含%字符会报错*/
printf("%s", s);/*安全*/
```

函数sprintf：

```javascript
int sprintf(char *string, char *format, arg1, arg2, ...);
```

除将结果字符串写入第一个参数string外，与printf完全相同。_string内存应做大以保存结果字符串。_

- [ex7-2](ex/7-2.c)：实现程序合理打印任何输入。至少可根据需求将非图形字符打印为8/16进制，并换行过长的文本行。

## 函数参数链表

## 格式化输入

## 文件访问

## 错误处理-stderr和exit

## 行输入/输出

## 其他函数

### 字符串操作

### 字符类型判断和转换

### Ungetc

### 系统命令执行

### 内存管理

### 数学函数

### 生成随机数
